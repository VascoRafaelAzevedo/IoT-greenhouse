# Dev overrides: optimized for CI testing
# For local development with hot-reload, use docker-compose.local.yml instead
services:
  postgres:
    environment:
      # Override database name for testing
      POSTGRES_DB: ${DB_NAME:-greenhouse_test}

  backend:
    environment:
      ENVIRONMENT: ${ENVIRONMENT:-development}
      LOG_LEVEL: ${LOG_LEVEL:-DEBUG}
      # Ensure backend uses test database
      DATABASE_URL: postgresql://${DB_USER:-postgres}:${DB_PASSWORD:-postgres}@postgres:5432/${DB_NAME:-greenhouse_test}
    # NO volume mounts in CI - use built code
    # For local dev, use docker-compose.local.yml

  consumer:
    environment:
      RUST_LOG: ${RUST_LOG:-debug}
      DB_NAME: ${DB_NAME:-greenhouse_test}
    # NO volume mounts in CI - use built binary

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        VITE_API_URL: ${VITE_API_URL:-http://localhost:4000}
    environment:
      VITE_API_URL: ${VITE_API_URL:-http://localhost:4000}
    # NO volume mounts in CI - use built static files